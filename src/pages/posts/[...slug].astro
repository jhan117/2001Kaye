---
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";

import Layout from "@layouts/Layout.astro"
import { formatDate, timeSince } from "@utils/dateUtils";
import sortPostsByPubDate from "@utils/postUtils";

export const getStaticPaths = (async () => {
  const posts: Post[] = await getCollection("posts");
  const postsCount = posts.length;
  return sortPostsByPubDate(posts).map((post, idx) => ({
    params: { slug: post.slug },
    props: {
      post,
      prevPost: idx + 1 === postsCount ? null : posts[idx + 1],
      nextpost: idx === 0 ? null : posts[idx - 1],
    },
  }));
}) satisfies GetStaticPaths;

const { post, prevPost, nextpost } = Astro.props;
const { Content } = await post.render();
---

<Layout>
  <p>{timeSince(post.data.pubDate)}</p>
  <h1>{post.data.title}</h1>
  <p>{formatDate(post.data.pubDate)}</p>
  <Content />
  <div>
    <ul>
      <li>
        <a href={prevPost?.slug}>
          <i class="fa-solid fa-chevron-left" />
          {prevPost?.data.title}
        </a>
      </li>
      <li>
        <a href={nextpost?.slug}>
          <i class="fa-solid fa-chevron-right" />
          {nextpost?.data.title}
        </a>
      </li>
    </ul>
  </div>
</Layout>